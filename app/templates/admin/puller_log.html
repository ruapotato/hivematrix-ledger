<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Puller Log - {{ job.job_name }}</title>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
    <div class="card">
        <div class="card__header">
            <h1 class="card__title">Log: {{ job.job_name }}</h1>
        </div>
        <div class="card__body">
            <p><strong>Script:</strong> <code>{{ job.script_path }}</code></p>
            <p><strong>Last Run:</strong> {{ job.last_run or 'Never' }}</p>
            <p>
                <strong>Status:</strong>
                {% if job.last_status == 'Success' %}
                <span class="u-text-success">
                    <i data-lucide="check-circle" style="width: 14px; height: 14px; vertical-align: middle;"></i>
                    Success
                </span>
                {% elif job.last_status == 'Running' %}
                <span class="u-text-info">
                    <i data-lucide="loader" style="width: 14px; height: 14px; vertical-align: middle;"></i>
                    Running...
                </span>
                {% elif job.last_status in ['Failure', 'Error'] %}
                <span class="u-text-danger">
                    <i data-lucide="alert-circle" style="width: 14px; height: 14px; vertical-align: middle;"></i>
                    {{ job.last_status }}
                </span>
                {% elif job.last_status == 'Timeout' %}
                <span class="u-text-warning">
                    <i data-lucide="alert-triangle" style="width: 14px; height: 14px; vertical-align: middle;"></i>
                    Timeout
                </span>
                {% else %}
                <span class="u-text-secondary">-</span>
                {% endif %}
            </p>
        </div>
    </div>

    <div class="card u-mt-2">
        <div class="card__header">
            <h2 class="card__title">Output Log</h2>
        </div>
        <div class="card__body">
            {% if job.last_run_log %}
            <pre class="code-block">{{ job.last_run_log }}</pre>
            {% else %}
            <p>No log output available. This job hasn't been run yet.</p>
            {% endif %}
        </div>
    </div>

    <div class="u-mt-2">
        <form method="POST" action="/ledger/admin/pullers/run/{{ job.id }}" style="display: inline;">
            <button type="submit" class="btn btn--primary" {% if job.last_status == 'Running' %}disabled{% endif %}>
                <span class="btn__label">
                    <i data-lucide="play" class="btn__icon"></i>
                    Run Again
                </span>
            </button>
        </form>
        <a href="/ledger/admin/pullers" class="btn">
            <span class="btn__label">
                <i data-lucide="arrow-left" class="btn__icon"></i>
                Back to Pullers
            </span>
        </a>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();
    </script>
</body>
</html>
